{"author":{"id":"2d08e4816aca0a07db9878f126b0e7f6d6f1362eb9bc4804be6b33ff8d0a19ec"},"ops":[{"type":1,"timestamp":1739717032,"nonce":"e3K42P3ikCuGGXXur7t6TouNT3Y=","metadata":{"github-id":"I_kwDOJl1IZM6qPUEo","github-url":"https://github.com/nikitabobko/AeroSpace/issues/1097","origin":"github"},"title":"Unreliable focus change when closing windows. Focus race condition with macOS","message":"When the window is closed, AeroSpace receives two events from macOS:\n- The window is destroyed\n- The focused window is changed\n\nThe events system is unreliable in macOS. The events might come in whatever order, or sometimes the events might not be even delivered ðŸ¤· \n\nAeroSpace logic relies neither on the nature of the events nor on their order. AeroSpace only uses events as a signal to \"re-evaluate the world\" (check if windows no longer exist, check if new windows are appeared, re-layout the windows)\n\n**And here comes the problem**, whenever AeroSpace detects that the window is destroyed, AeroSpace issues a focus request to focus the previously focused window on the workspace of the destroyed window. We do so to keep the focused workspace focused (Pointer in the code: `MacWindow.swift:garbageCollect`). Unfortunately, AeroSpace plays a \"race condition\" game with the macOS that tries to focus next window of the app.\n\nIt leads to the following user facing issues:\n1. If the window is closed on non-focused workspace, AeroSpace will switch focus to that workspace https://github.com/nikitabobko/AeroSpace/issues/1089\n2. AeroSpace may lose the \"race condition\" https://github.com/nikitabobko/AeroSpace/issues/854 https://github.com/nikitabobko/AeroSpace/issues/571\n\nWhat is the proposed solution to fix the problem? I don't have one. I don't know. Until it's clear how to fix the issue, the issue exists for the documentation purposes.\n\nAlso read the thread: https://github.com/nikitabobko/AeroSpace/issues/571","files":null}]}