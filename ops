{"author":{"id":"2d08e4816aca0a07db9878f126b0e7f6d6f1362eb9bc4804be6b33ff8d0a19ec"},"ops":[{"type":1,"timestamp":1742728509,"nonce":"1Dnl7ugpEGVhE/ZrBB/I+6E89G8=","metadata":{"github-id":"I_kwDOJl1IZM6vTa44","github-url":"https://github.com/nikitabobko/AeroSpace/issues/1231","origin":"github"},"title":"Binding `reload-config` in the `main` binding mode is unreliable","message":"To reproduce, run AeroSpace with the following config snippet:\n```\n[mode.main.binding]\n    # dialog command is to indicate whether the keybinding was triggered.\n    alt-e = ['reload-config', '''exec-and-forget osascript -e 'display dialog \"Test\"' ''']\n```\n\nPressing alt-e once triggers the keybind as expected. However, pressing alt-e a second time will no longer trigger the key binding.\n\nI suspect the issue is that the [HotKey library](https://github.com/soffes/HotKey/) ties hotkey registration/deregistration to the lifetime of the HotKey object: https://github.com/soffes/HotKey/blob/a3cf605d7a96f6ff50e04fcb6dea6e2613cfcbe4/Sources/HotKey/HotKey.swift#L30-L50\n\nHotkey handlers are called with the `HotKey` object still in scope:\nhttps://github.com/soffes/HotKey/blob/a3cf605d7a96f6ff50e04fcb6dea6e2613cfcbe4/Sources/HotKey/HotKeysController.swift#L127-L133\n\nWhen a `ReloadConfigCommand` triggered by a hotkey resets and reinstalls hotkeys, the `HotKey` for the reload is still alive. I suspect this causes attempts to register the same hotkey in the reloaded config to fail silently at:\nhttps://github.com/soffes/HotKey/blob/a3cf605d7a96f6ff50e04fcb6dea6e2613cfcbe4/Sources/HotKey/HotKeysController.swift#L69-L72\n\nIt's pretty easy to work around this in practice by binding `exec-and-forget aerospace reload-config` instead of `reload-config`, but it would be nice if this sharp edge didn't exist.\n\nPerhaps a fix could be to change `ReloadConfigCommand` to dispatch a separate callback to the main thread so that the config reload no longer runs from inside a hotkey handler. Alternately, `resetHotKeys` could unregister existing hotkeys by setting `isPaused = true` on every hotkey before clearing `hotkeys`.\n\nbtw, thank you so much for building AeroSpace - I have long wished for a macOS window manager that implements its own workspaces instead of building on the not-great Spaces model/APIs!\n\n_Originally posted by @rickyz in https://github.com/nikitabobko/AeroSpace/discussions/1230_","files":null}]}