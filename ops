{"author":{"id":"2d08e4816aca0a07db9878f126b0e7f6d6f1362eb9bc4804be6b33ff8d0a19ec"},"ops":[{"type":1,"timestamp":1742129014,"nonce":"7I7EFzjAd65WoJRbMM5tVktEClA=","metadata":{"github-id":"I_kwDOJl1IZM6uOYFV","github-url":"https://github.com/nikitabobko/AeroSpace/issues/1215","origin":"github"},"title":"Big meta issue: rewrite core `TreeNode` mutable double-linked tree data structure to immutable single-linked persistent tree","message":"`TreeNode` is a core data structure of AeroSpace and unfortunately it's mutable.\n\nThe proposal is to rewrite it to immutable single-linked persistent tree.\n\nMotivation:\n1. Stability. The current logic for binding two `TreeNode` is fragile and sometimes leads to hard to debug crashes: https://github.com/nikitabobko/AeroSpace/issues/706\n2. Performance. Once we make AeroSpace multi-threaded to handle hanging apps (https://github.com/nikitabobko/AeroSpace/issues/131), instead of \"drawing\" the layout on main thread and sending requests to app-threads, it makes sense to pass the tree data structure to each app-thread so that it could draw its part of the tree, which effectively makes the drawing multi-threaded by number of apps. Multi-threading drawing will help to reduce threads context switching for cases when apps have several visible windows. Though the tree has to be traversed multiple times in multi-threaded drawing approach. Precise performance measurements needs to be done.\n3. It makes it possible to take snapshots of the tree on its every modification before windows start \"dying out\" when the screen is locked. It should help to fix this issue: \n4. Features like `aerospace undo` become possible (though, it may be too far fetched, who would need such a feature?)","files":null}]}