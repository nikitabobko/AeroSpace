{"author":{"id":"874e9296cdffc3475c4c2fde289194b3524f2f9809e119df0bb225b4369a5c4f"},"ops":[{"type":3,"timestamp":1732930617,"nonce":"OeJJ2sQfx7/8raNna5aNwC0RtsI=","metadata":{"github-id":"IC_kwDOJl1IZM6ViOnn","github-url":"https://github.com/nikitabobko/AeroSpace/issues/776#issuecomment-2508777959"},"message":"This is a complex secnario, I've done my best to create steps to reproduce the issue.\n\nI appreciate your effort to invest this issue. I can't bear it if I can't use Emacs.\n\nEverything will be contained in the test directory, after testing you can just delete the test directory.\n\n![Screen Recording 2024-11-30 at 01 45 15](https://github.com/user-attachments/assets/54429a00-f110-48e8-beae-1cb95c59d9c3)\n\nI have tested following scripts\n\n# Steps to reproduce the issue\n```shell\n# create the testing directory\nmkdir emacs-q\ncd emacs-q\n# install emacs using homebrew\nbrew tap d12frosted/emacs-plus\nbrew install emacs-plus@29 --with-no-frame-refocus\n\n# create a python virtual environment with dependences for lsp-bridge\ncat \u003e lsp-bridge.txt \u003c\u003c EOF\nepc==0.0.5\norjson==3.9.10\nsexpdata==1.0.0\nsetuptools==69.0.2\nrapidfuzz==3.6.1\nparamiko==3.4.0\nsix==1.16.0\nwatchdog==5.0.3\nEOF\n\npython3 -m venv venv \u0026\u0026 venv/bin/pip install -r lsp-bridge.txt\n\n# setup emacs\n\ncat \u003e init.el \u003c\u003cEOF\n;; Disable startup screen\n(setq inhibit-startup-screen t)\n\n;; Set initial buffer to *scratch*\n(setq initial-buffer-choice t)\n\n;; Bootstrap straight.el\n(defvar bootstrap-version)\n(let ((bootstrap-file\n       (expand-file-name \"straight/repos/straight.el/bootstrap.el\" user-emacs-directory))\n      (bootstrap-version 6))\n  (unless (file-exists-p bootstrap-file)\n    (with-current-buffer\n        (url-retrieve-synchronously\n         \"https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el\"\n         'silent 'inhibit-cookies)\n      (goto-char (point-max))\n      (eval-print-last-sexp)))\n  (load bootstrap-file nil 'nomessage))\n\n;; Configure straight to use use-package\n(straight-use-package 'use-package)\n(setq straight-use-package-by-default t)\n\n;; Set *scratch* buffer to emacs-lisp-mode\n(setq initial-major-mode 'emacs-lisp-mode)\n\n;; Install required dependencies\n(use-package markdown-mode\n  :straight t)\n\n(use-package yasnippet\n  :straight t\n  :config\n  (yas-global-mode 1))\n\n;; Install and configure lsp-bridge\n(use-package lsp-bridge\n  :straight '(lsp-bridge :type git\n                        :host github\n                        :repo \"manateelazycat/lsp-bridge\"\n                        :files (\"*.el\" \"*.py\" \"acm\" \"core\" \"langserver\" \"multiserver\" \"resources\"))\n  :init\n  (setq lsp-bridge-python-command (expand-file-name \"venv/bin/python\" default-directory)))\n\n;; Ensure *scratch* is the initial buffer\n(setq inhibit-startup-buffer-menu t)\n\n;; Add startup message to scratch buffer\n(add-hook 'emacs-startup-hook\n          (lambda ()\n            (with-current-buffer \"*scratch*\"\n              (lsp-bridge-mode)\n              (goto-char (point-max))\n              (insert \"\\n;; Debug: init.el loaded successfully at \" (current-time-string) \"\\n\")\n              (insert \";; LSP-Bridge status: \" (if (bound-and-true-p lsp-bridge-mode) \"enabled\" \"disabled\") \"\\n\\n\")\n              (insert \";; With Aerospace enabled, try to type a long symbol for example \\n\")\n              (insert \"emacs-lisp-compilation-mode-syntax-table\\n\\n\")\n              (insert \";; while typing the completion menu will showup and press TAB to trigger the completion \\n\")\n              (insert \";;observe that the focused window will jump to the next application window after pressing TAB.\\n\")\n              (insert \";;This will also happen when you are typing fast.\\n\")\n              (insert \"\\n\")\n              (goto-char (point-max)))))\nEOF\n```\n\n# start emacs to test\n\nWith aerospace 0.16.0 enabled, start the emacs. \n\nEmacs will download all the dependecies to the testing directory, if you see *warning* on Emacs, just ignore it.\n\n```shell\nemacs --init-directory=. -Q -l init.el\n```\n\n\n# Steps to cleanup after testing\n\n```shell\nbrew uninstall emacs-plus@29\nbrew untap d12frosted/emacs-plus\n```\n\nremove the testing directory","files":null},{"type":6,"timestamp":1732930761,"nonce":"eNzISIfDKDNVvBfEAg1LFiqKmtU=","metadata":{"github-id":"UCE_lALOJl1IZM6ViOnnzlZvbWA"},"target":"60733d8d060910cd14cf669b2732a10cafe2913ea0c6e3e0a2b7e049b73799be","message":"This is a complex secnario, I've done my best to create steps to reproduce the issue.\n\nI appreciate your effort to invest this issue. I can't bear it if I can't use Emacs.\n\nEverything will be contained in the test directory, after testing you can just delete the test directory.\n\n![Screen Recording 2024-11-30 at 01 45 15](https://github.com/user-attachments/assets/54429a00-f110-48e8-beae-1cb95c59d9c3)\n\nThe screen record shows that while typing the completion menu shows up, press TAB to trigger the completion, and then the focused window jump to another application. Rollback to previous version of aerospace with the same setup, it won't hapen.\n\n\nI have tested following scripts\n\n# Steps to reproduce the issue\n```shell\n# create the testing directory\nmkdir emacs-q\ncd emacs-q\n# install emacs using homebrew\nbrew tap d12frosted/emacs-plus\nbrew install emacs-plus@29 --with-no-frame-refocus\n\n# create a python virtual environment with dependences for lsp-bridge\ncat \u003e lsp-bridge.txt \u003c\u003c EOF\nepc==0.0.5\norjson==3.9.10\nsexpdata==1.0.0\nsetuptools==69.0.2\nrapidfuzz==3.6.1\nparamiko==3.4.0\nsix==1.16.0\nwatchdog==5.0.3\nEOF\n\npython3 -m venv venv \u0026\u0026 venv/bin/pip install -r lsp-bridge.txt\n\n# setup emacs\n\ncat \u003e init.el \u003c\u003cEOF\n;; Disable startup screen\n(setq inhibit-startup-screen t)\n\n;; Set initial buffer to *scratch*\n(setq initial-buffer-choice t)\n\n;; Bootstrap straight.el\n(defvar bootstrap-version)\n(let ((bootstrap-file\n       (expand-file-name \"straight/repos/straight.el/bootstrap.el\" user-emacs-directory))\n      (bootstrap-version 6))\n  (unless (file-exists-p bootstrap-file)\n    (with-current-buffer\n        (url-retrieve-synchronously\n         \"https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el\"\n         'silent 'inhibit-cookies)\n      (goto-char (point-max))\n      (eval-print-last-sexp)))\n  (load bootstrap-file nil 'nomessage))\n\n;; Configure straight to use use-package\n(straight-use-package 'use-package)\n(setq straight-use-package-by-default t)\n\n;; Set *scratch* buffer to emacs-lisp-mode\n(setq initial-major-mode 'emacs-lisp-mode)\n\n;; Install required dependencies\n(use-package markdown-mode\n  :straight t)\n\n(use-package yasnippet\n  :straight t\n  :config\n  (yas-global-mode 1))\n\n;; Install and configure lsp-bridge\n(use-package lsp-bridge\n  :straight '(lsp-bridge :type git\n                        :host github\n                        :repo \"manateelazycat/lsp-bridge\"\n                        :files (\"*.el\" \"*.py\" \"acm\" \"core\" \"langserver\" \"multiserver\" \"resources\"))\n  :init\n  (setq lsp-bridge-python-command (expand-file-name \"venv/bin/python\" default-directory)))\n\n;; Ensure *scratch* is the initial buffer\n(setq inhibit-startup-buffer-menu t)\n\n;; Add startup message to scratch buffer\n(add-hook 'emacs-startup-hook\n          (lambda ()\n            (with-current-buffer \"*scratch*\"\n              (lsp-bridge-mode)\n              (goto-char (point-max))\n              (insert \"\\n;; Debug: init.el loaded successfully at \" (current-time-string) \"\\n\")\n              (insert \";; LSP-Bridge status: \" (if (bound-and-true-p lsp-bridge-mode) \"enabled\" \"disabled\") \"\\n\\n\")\n              (insert \";; With Aerospace enabled, try to type a long symbol for example \\n\")\n              (insert \"emacs-lisp-compilation-mode-syntax-table\\n\\n\")\n              (insert \";; while typing the completion menu will showup and press TAB to trigger the completion \\n\")\n              (insert \";;observe that the focused window will jump to the next application window after pressing TAB.\\n\")\n              (insert \";;This will also happen when you are typing fast.\\n\")\n              (insert \"\\n\")\n              (goto-char (point-max)))))\nEOF\n```\n\n# start emacs to test\n\nWith aerospace 0.16.0 enabled, start the emacs. \n\nEmacs will download all the dependecies to the testing directory, if you see *warning* on Emacs, just ignore it.\n\n```shell\nemacs --init-directory=. -Q -l init.el\n```\n\n\n# Steps to cleanup after testing\n\n```shell\nbrew uninstall emacs-plus@29\nbrew untap d12frosted/emacs-plus\n```\n\nremove the testing directory","files":null},{"type":6,"timestamp":1732930836,"nonce":"8s6lqfK124Iegzgqp/x4ZodQ9OM=","metadata":{"github-id":"UCE_lALOJl1IZM6ViOnnzlZvbvY"},"target":"60733d8d060910cd14cf669b2732a10cafe2913ea0c6e3e0a2b7e049b73799be","message":"This is a complex secnario, I've done my best to create steps to reproduce the issue.\n\nI appreciate your effort to invest this issue. I can't bear it if I can't use Emacs.\n\nEverything will be contained in the test directory, after testing you can just delete the test directory.\n\n![Screen Recording 2024-11-30 at 01 45 15](https://github.com/user-attachments/assets/54429a00-f110-48e8-beae-1cb95c59d9c3)\n\nThe screen record shows that while typing the completion menu shows up, press TAB to trigger the completion, and then the focused window jump to another application. Rollback to previous version of aerospace with the same setup, it won't hapen.\n\n\nI have tested following scripts\n\n# Steps to reproduce the issue\n```shell\n# create the testing directory\nmkdir emacs-q\ncd emacs-q\n\n# install emacs using homebrew\nbrew tap d12frosted/emacs-plus\nbrew install emacs-plus@29 --with-no-frame-refocus\n\n# create a python virtual environment with dependences for lsp-bridge\ncat \u003e lsp-bridge.txt \u003c\u003c EOF\nepc==0.0.5\norjson==3.9.10\nsexpdata==1.0.0\nsetuptools==69.0.2\nrapidfuzz==3.6.1\nparamiko==3.4.0\nsix==1.16.0\nwatchdog==5.0.3\nEOF\n\npython3 -m venv venv \u0026\u0026 venv/bin/pip install -r lsp-bridge.txt\n\n# setup emacs\n\ncat \u003e init.el \u003c\u003cEOF\n;; Disable startup screen\n(setq inhibit-startup-screen t)\n\n;; Set initial buffer to *scratch*\n(setq initial-buffer-choice t)\n\n;; Bootstrap straight.el\n(defvar bootstrap-version)\n(let ((bootstrap-file\n       (expand-file-name \"straight/repos/straight.el/bootstrap.el\" user-emacs-directory))\n      (bootstrap-version 6))\n  (unless (file-exists-p bootstrap-file)\n    (with-current-buffer\n        (url-retrieve-synchronously\n         \"https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el\"\n         'silent 'inhibit-cookies)\n      (goto-char (point-max))\n      (eval-print-last-sexp)))\n  (load bootstrap-file nil 'nomessage))\n\n;; Configure straight to use use-package\n(straight-use-package 'use-package)\n(setq straight-use-package-by-default t)\n\n;; Set *scratch* buffer to emacs-lisp-mode\n(setq initial-major-mode 'emacs-lisp-mode)\n\n;; Install required dependencies\n(use-package markdown-mode\n  :straight t)\n\n(use-package yasnippet\n  :straight t\n  :config\n  (yas-global-mode 1))\n\n;; Install and configure lsp-bridge\n(use-package lsp-bridge\n  :straight '(lsp-bridge :type git\n                        :host github\n                        :repo \"manateelazycat/lsp-bridge\"\n                        :files (\"*.el\" \"*.py\" \"acm\" \"core\" \"langserver\" \"multiserver\" \"resources\"))\n  :init\n  (setq lsp-bridge-python-command (expand-file-name \"venv/bin/python\" default-directory)))\n\n;; Ensure *scratch* is the initial buffer\n(setq inhibit-startup-buffer-menu t)\n\n;; Add startup message to scratch buffer\n(add-hook 'emacs-startup-hook\n          (lambda ()\n            (with-current-buffer \"*scratch*\"\n              (lsp-bridge-mode)\n              (goto-char (point-max))\n              (insert \"\\n;; Debug: init.el loaded successfully at \" (current-time-string) \"\\n\")\n              (insert \";; LSP-Bridge status: \" (if (bound-and-true-p lsp-bridge-mode) \"enabled\" \"disabled\") \"\\n\\n\")\n              (insert \";; With Aerospace enabled, try to type a long symbol for example \\n\")\n              (insert \"emacs-lisp-compilation-mode-syntax-table\\n\\n\")\n              (insert \";; while typing the completion menu will showup and press TAB to trigger the completion \\n\")\n              (insert \";;observe that the focused window will jump to the next application window after pressing TAB.\\n\")\n              (insert \";;This will also happen when you are typing fast.\\n\")\n              (insert \"\\n\")\n              (goto-char (point-max)))))\nEOF\n```\n\n# start emacs to test\n\nWith aerospace 0.16.0 enabled, start the emacs. \n\nEmacs will download all the dependecies to the testing directory, if you see *warning* on Emacs, just ignore it.\n\n```shell\nemacs --init-directory=. -Q -l init.el\n```\n\n\n# Steps to cleanup after testing\n\n```shell\nbrew uninstall emacs-plus@29\nbrew untap d12frosted/emacs-plus\n```\n\nremove the testing directory","files":null}]}