{"author":{"id":"e372f09fef49f5aa7613c7ec99294fa7d46aec3344c32fa8b71488092f24278d"},"ops":[{"type":3,"timestamp":1722517673,"nonce":"AyegH5VacNS7FS6mVZGFFwNTUbQ=","metadata":{"github-id":"IC_kwDOJl1IZM6G4piY","github-url":"https://github.com/nikitabobko/AeroSpace/issues/230#issuecomment-2262997144"},"message":"@nikitabobko using `on-focus-changed` in combination with `aerospace list-windows --workspace $ws` is pretty slow as it uses alot of resources.\nMy current implementation is:\n\n`.aerospace.toml`\n```toml\non-focus-changed = [\n    'exec-and-forget sketchybar --trigger aerospace_workspace_change FOCUS_CHANGE=true'\n]\n```\n\nmy event script:\n```bash\nif [[ \"$FOCUS_CHANGE\" == \"true\" ]]; then\n    FOCUSED_WORKSPACE=\"$(aerospace list-workspaces --focused)\"\n    if [[ \"$NAME\" = \"space.$FOCUSED_WORKSPACE\" ]]; then\n        rewriteSketchybar \"$FOCUSED_WORKSPACE\"\n    fi\nfi\n```\n\nIs it maybe possible to add the focused workspace to every event? This would reduce alot of aerospace queries.\nAlso the focused monitor would be helpful. WDYT?","files":null},{"type":6,"timestamp":1722520406,"nonce":"oSLPYG8W7B9tckVOp1CMadcHC14=","metadata":{"github-id":"UCE_lALOJl1IZM6G4piYzkxGWcM"},"target":"09159b336f04d0a236aea9405c484e20ba250b785fdce87235332fcbf939ab71","message":"@nikitabobko using `on-focus-changed` in combination with `aerospace list-windows --workspace $ws` is pretty slow as it uses alot of resources.\nMy current implementation is:\n\n`.aerospace.toml`\n```toml\non-focus-changed = [\n    'exec-and-forget sketchybar --trigger aerospace_workspace_change FOCUS_CHANGE=true'\n]\n```\n\nmy event script:\n```bash\nif [[ \"$FOCUS_CHANGE\" == \"true\" ]]; then\n    FOCUSED_WORKSPACE=\"$(aerospace list-workspaces --focused)\"\n    if [[ \"$NAME\" = \"space.$FOCUSED_WORKSPACE\" ]]; then\n        rewriteSketchybar \"$FOCUSED_WORKSPACE\"\n    fi\nfi\n```\n\nIs it maybe possible to add the focused workspace to every event? This would reduce alot of aerospace queries.\nAlso the focused monitor would be helpful. WDYT?\n\nEdit: just as an idea\n\n```diff\ndiff --git a/Sources/AppBundle/focus.swift b/Sources/AppBundle/focus.swift\nindex f5b79b6..9cad438 100644\n--- a/Sources/AppBundle/focus.swift\n+++ b/Sources/AppBundle/focus.swift\n@@ -144,10 +144,16 @@ func checkOnFocusChangedCallbacks() {\n\n private func onFocusedMonitorChanged(_ focus: LiveFocus) {\n     if config.onFocusedMonitorChanged.isEmpty { return }\n+    environment[\"AEROSPACE_FOCUSED_WORKSPACE\"] = newWorkspace\n+    environment[\"AEROSPACE_PREV_WORKSPACE\"] = oldWorkspace\n+    environment[\"AEROSPACE_FOCUSED_MONITOR\"] = workspace.workspaceMonitor.monitorId\n     _ = config.onFocusedMonitorChanged.run(CommandMutableState(focus.asLeaf.asCommandSubject))\n }\n private func onFocusChanged(_ focus: LiveFocus) {\n     if config.onFocusChanged.isEmpty { return }\n+    environment[\"AEROSPACE_FOCUSED_WORKSPACE\"] = newWorkspace\n+    environment[\"AEROSPACE_PREV_WORKSPACE\"] = oldWorkspace\n+    environment[\"AEROSPACE_FOCUSED_MONITOR\"] = workspace.workspaceMonitor.monitorId\n     _ = config.onFocusChanged.run(CommandMutableState(focus.asLeaf.asCommandSubject))\n }\n\n@@ -159,6 +165,7 @@ private func onWorkspaceChanged(_ oldWorkspace: String, _ newWorkspace: String)\n         var environment = config.execConfig.envVariables\n         environment[\"AEROSPACE_FOCUSED_WORKSPACE\"] = newWorkspace\n         environment[\"AEROSPACE_PREV_WORKSPACE\"] = oldWorkspace\n+        environment[\"AEROSPACE_FOCUSED_MONITOR\"] = workspace.workspaceMonitor.monitorId\n         process.environment = environment\n         Result { try process.run() }.getOrThrow() // todo It's not perfect to fail here\n```","files":null},{"type":6,"timestamp":1722520449,"nonce":"v6DszMYrx8hXaaDLnb0bxQ9+/YA=","metadata":{"github-id":"UCE_lALOJl1IZM6G4piYzkxGXlI"},"target":"09159b336f04d0a236aea9405c484e20ba250b785fdce87235332fcbf939ab71","message":"@nikitabobko using `on-focus-changed` in combination with `aerospace list-windows --workspace $ws` is pretty slow as it uses alot of resources.\nMy current implementation is:\n\n`.aerospace.toml`\n```toml\non-focus-changed = [\n    'exec-and-forget sketchybar --trigger aerospace_workspace_change FOCUS_CHANGE=true'\n]\n```\n\nmy event script:\n```bash\nif [[ \"$FOCUS_CHANGE\" == \"true\" ]]; then\n    FOCUSED_WORKSPACE=\"$(aerospace list-workspaces --focused)\"\n    if [[ \"$NAME\" = \"space.$FOCUSED_WORKSPACE\" ]]; then\n        rewriteSketchybar \"$FOCUSED_WORKSPACE\"\n    fi\nfi\n```\n\nIs it maybe possible to add the focused workspace to every event? This would reduce alot of aerospace queries.\nAlso the focused monitor would be helpful. WDYT?\n\nEdit: just as an idea\n\n```diff\ndiff --git a/Sources/AppBundle/focus.swift b/Sources/AppBundle/focus.swift\nindex f5b79b6..4c1f03b 100644\n--- a/Sources/AppBundle/focus.swift\n+++ b/Sources/AppBundle/focus.swift\n@@ -159,6 +159,7 @@ private func onWorkspaceChanged(_ oldWorkspace: String, _ newWorkspace: String)\n         var environment = config.execConfig.envVariables\n         environment[\"AEROSPACE_FOCUSED_WORKSPACE\"] = newWorkspace\n         environment[\"AEROSPACE_PREV_WORKSPACE\"] = oldWorkspace\n+        environment[\"AEROSPACE_FOCUSED_MONITOR\"] = workspace.workspaceMonitor.monitorId\n         process.environment = environment\n         Result { try process.run() }.getOrThrow() // todo It's not perfect to fail here\n     }\n```","files":null},{"type":6,"timestamp":1722520486,"nonce":"+XLLK+v9kzigloyz6fthnyueuSU=","metadata":{"github-id":"UCE_lALOJl1IZM6G4piYzkxGYjs"},"target":"09159b336f04d0a236aea9405c484e20ba250b785fdce87235332fcbf939ab71","message":"@nikitabobko using `on-focus-changed` in combination with `aerospace list-windows --workspace $ws` is pretty slow as it uses alot of resources.\nMy current implementation is:\n\n`.aerospace.toml`\n```toml\non-focus-changed = [\n    'exec-and-forget sketchybar --trigger aerospace_workspace_change FOCUS_CHANGE=true'\n]\n```\n\nmy event script:\n```bash\nif [[ \"$FOCUS_CHANGE\" == \"true\" ]]; then\n    FOCUSED_WORKSPACE=\"$(aerospace list-workspaces --focused)\"\n    if [[ \"$NAME\" = \"space.$FOCUSED_WORKSPACE\" ]]; then\n        rewriteSketchybar \"$FOCUSED_WORKSPACE\"\n    fi\nfi\n```\n\nIs it maybe possible to add the focused workspace to every event? This would reduce alot of aerospace queries.\nAlso the focused monitor would be helpful. WDYT?","files":null}]}